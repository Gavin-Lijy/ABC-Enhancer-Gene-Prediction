JOB_ID=618445
Building DAG of jobs...
Using shell: /usr/bin/bash
Provided cores: 1 (use --cores to define parallelism)
Rules claiming more threads will be scaled down.
Provided resources: mem_mb=32000, mem_mib=30518, disk_mb=1000, disk_mib=954
Conda environments: ignored
Select jobs to execute...

[Tue Mar  4 15:22:43 2025]
rule create_neighborhoods:
    input: /home/jl9324/Sperm_3D_Genome_Project/multiome/ABC_model/SPT/Peaks/macs2_peaks.narrowPeak.sorted.candidateRegions.bed, /home/jl9324/Sperm_3D_Genome_Project/multiome/ABC_model/tmp/GRCh38_EBV.no_alt.chrom.sizes.tsv.bed
    output: /home/jl9324/Sperm_3D_Genome_Project/multiome/ABC_model/SPT/Neighborhoods/EnhancerList.txt, /home/jl9324/Sperm_3D_Genome_Project/multiome/ABC_model/SPT/Neighborhoods/GeneList.txt, /home/jl9324/Sperm_3D_Genome_Project/multiome/ABC_model/SPT/Neighborhoods, /home/jl9324/Sperm_3D_Genome_Project/multiome/ABC_model/SPT/processed_genes_file.bed
    jobid: 0
    reason: Forced execution
    wildcards: biosample=SPT
    resources: mem_mb=32000, mem_mib=30518, disk_mb=1000, disk_mib=954, tmpdir=/home/jl9324/mnt/scratch/jl9324


		# get sorted & unique gene list
		# intersect first to remove alternate chromosomes
		bedtools intersect -u -a /home/jl9324/env/download/ABC-Enhancer-Gene-Prediction/reference/hg38/CollapsedGeneBounds.hg38.bed -b /home/jl9324/Sperm_3D_Genome_Project/multiome/ABC_model/tmp/GRCh38_EBV.no_alt.chrom.sizes.tsv.bed | 		bedtools sort -faidx /home/jl9324/env/download/ABC-Enhancer-Gene-Prediction/reference/hg38/GRCh38_EBV.no_alt.chrom.sizes.tsv -i stdin | 		uniq > /home/jl9324/Sperm_3D_Genome_Project/multiome/ABC_model/SPT/processed_genes_file.bed
						
		python /home/jl9324/env/download/ABC-Enhancer-Gene-Prediction/workflow/scripts/run.neighborhoods.py 			--candidate_enhancer_regions /home/jl9324/Sperm_3D_Genome_Project/multiome/ABC_model/SPT/Peaks/macs2_peaks.narrowPeak.sorted.candidateRegions.bed 			--DHS  			--ATAC /home/jl9324/Sperm_3D_Genome_Project/multiome/processed/bigwig/Spermatocytes.tagAlign.gz 			--default_accessibility_feature ATAC 			--chrom_sizes /home/jl9324/env/download/ABC-Enhancer-Gene-Prediction/reference/hg38/GRCh38_EBV.no_alt.chrom.sizes.tsv 			--chrom_sizes_bed /home/jl9324/Sperm_3D_Genome_Project/multiome/ABC_model/tmp/GRCh38_EBV.no_alt.chrom.sizes.tsv.bed 			--outdir /home/jl9324/Sperm_3D_Genome_Project/multiome/ABC_model/SPT/Neighborhoods 			--genes /home/jl9324/Sperm_3D_Genome_Project/multiome/ABC_model/SPT/processed_genes_file.bed 			--ubiquitously_expressed_genes /home/jl9324/env/download/ABC-Enhancer-Gene-Prediction/reference/UbiquitouslyExpressedGenes.txt 			--H3K27ac  			--qnorm /home/jl9324/env/download/ABC-Enhancer-Gene-Prediction/reference/EnhancersQNormRef.K562.txt 
		
/home/jl9324/miniforge3/envs/abc-env/lib/python3.10/site-packages/pyranges/methods/init.py:45: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  return {k: v for k, v in df.groupby(grpby_key)}
***** WARNING: File /home/jl9324/Sperm_3D_Genome_Project/multiome/processed/bigwig/Spermatocytes.tagAlign.gz has inconsistent naming convention for record:
GL000009.2	3332	3356	N	1000	+

***** WARNING: File /home/jl9324/Sperm_3D_Genome_Project/multiome/processed/bigwig/Spermatocytes.tagAlign.gz has inconsistent naming convention for record:
GL000009.2	3332	3356	N	1000	+

***** WARNING: File /home/jl9324/Sperm_3D_Genome_Project/multiome/processed/bigwig/Spermatocytes.tagAlign.gz has inconsistent naming convention for record:
GL000009.2	3332	3356	N	1000	+

/home/jl9324/miniforge3/envs/abc-env/lib/python3.10/site-packages/pyranges/methods/init.py:45: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  return {k: v for k, v in df.groupby(grpby_key)}
/home/jl9324/miniforge3/envs/abc-env/lib/python3.10/site-packages/pyranges/methods/init.py:45: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  return {k: v for k, v in df.groupby(grpby_key)}
/home/jl9324/miniforge3/envs/abc-env/lib/python3.10/site-packages/pyranges/methods/init.py:45: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  return {k: v for k, v in df.groupby(grpby_key)}
Namespace(candidate_enhancer_regions='/home/jl9324/Sperm_3D_Genome_Project/multiome/ABC_model/SPT/Peaks/macs2_peaks.narrowPeak.sorted.candidateRegions.bed', outdir='/home/jl9324/Sperm_3D_Genome_Project/multiome/ABC_model/SPT/Neighborhoods', genes='/home/jl9324/Sperm_3D_Genome_Project/multiome/ABC_model/SPT/processed_genes_file.bed', genes_for_class_assignment=None, ubiquitously_expressed_genes='/home/jl9324/env/download/ABC-Enhancer-Gene-Prediction/reference/UbiquitouslyExpressedGenes.txt', gene_name_annotations='symbol', primary_gene_identifier='symbol', skip_gene_counts=False, H3K27ac=None, DHS=None, ATAC='/home/jl9324/Sperm_3D_Genome_Project/multiome/processed/bigwig/Spermatocytes.tagAlign.gz', default_accessibility_feature='ATAC', expression_table='', qnorm='/home/jl9324/env/download/ABC-Enhancer-Gene-Prediction/reference/EnhancersQNormRef.K562.txt', tss_slop_for_class_assignment=500, skip_rpkm_quantile=False, use_secondary_counting_method=False, chrom_sizes='/home/jl9324/env/download/ABC-Enhancer-Gene-Prediction/reference/hg38/GRCh38_EBV.no_alt.chrom.sizes.tsv', chrom_sizes_bed='/home/jl9324/Sperm_3D_Genome_Project/multiome/ABC_model/tmp/GRCh38_EBV.no_alt.chrom.sizes.tsv.bed', enhancer_class_override=None, supplementary_features=None, cellType=None)
Running command: bedtools sort -faidx /home/jl9324/env/download/ABC-Enhancer-Gene-Prediction/reference/hg38/GRCh38_EBV.no_alt.chrom.sizes.tsv -i /home/jl9324/Sperm_3D_Genome_Project/multiome/ABC_model/SPT/Neighborhoods/GeneList.TSS1kb.bed > /home/jl9324/Sperm_3D_Genome_Project/multiome/ABC_model/SPT/Neighborhoods/GeneList.TSS1kb.bed.sorted; mv /home/jl9324/Sperm_3D_Genome_Project/multiome/ABC_model/SPT/Neighborhoods/GeneList.TSS1kb.bed.sorted /home/jl9324/Sperm_3D_Genome_Project/multiome/ABC_model/SPT/Neighborhoods/GeneList.TSS1kb.bed
Generating /home/jl9324/Sperm_3D_Genome_Project/multiome/ABC_model/SPT/Neighborhoods/Genes.ATAC.Spermatocytes.tagAlign.gz.CountReads.bedgraph
Counting coverage for Genes.ATAC.Spermatocytes.tagAlign.gz
Running piped cmds: ['bedtools intersect -u -a /home/jl9324/Sperm_3D_Genome_Project/multiome/processed/bigwig/Spermatocytes.tagAlign.gz -b /home/jl9324/Sperm_3D_Genome_Project/multiome/ABC_model/tmp/GRCh38_EBV.no_alt.chrom.sizes.tsv.bed', 'bedtools coverage -counts -sorted -g /home/jl9324/env/download/ABC-Enhancer-Gene-Prediction/reference/hg38/GRCh38_EBV.no_alt.chrom.sizes.tsv -b - -a /home/jl9324/Sperm_3D_Genome_Project/multiome/ABC_model/SPT/Neighborhoods/GeneList.bed', 'awk \'{{print $1 "\\t" $2 "\\t" $3 "\\t" $NF}}\' > /home/jl9324/Sperm_3D_Genome_Project/multiome/ABC_model/SPT/Neighborhoods/Genes.ATAC.Spermatocytes.tagAlign.gz.CountReads.bedgraph']
Running command: awk 'BEGIN {FS=OFS="\t"} (substr($1, length($1)) == "X" || substr($1, length($1)) == "Y") { $4 *= 2 } 1' /home/jl9324/Sperm_3D_Genome_Project/multiome/ABC_model/SPT/Neighborhoods/Genes.ATAC.Spermatocytes.tagAlign.gz.CountReads.bedgraph > /home/jl9324/Sperm_3D_Genome_Project/multiome/ABC_model/SPT/Neighborhoods/Genes.ATAC.Spermatocytes.tagAlign.gz.CountReads.bedgraph.tmp && mv /home/jl9324/Sperm_3D_Genome_Project/multiome/ABC_model/SPT/Neighborhoods/Genes.ATAC.Spermatocytes.tagAlign.gz.CountReads.bedgraph.tmp /home/jl9324/Sperm_3D_Genome_Project/multiome/ABC_model/SPT/Neighborhoods/Genes.ATAC.Spermatocytes.tagAlign.gz.CountReads.bedgraph
Feature ATAC completed in 184.88878870010376
Generating /home/jl9324/Sperm_3D_Genome_Project/multiome/ABC_model/SPT/Neighborhoods/Genes.TSS1kb.ATAC.Spermatocytes.tagAlign.gz.CountReads.bedgraph
Counting coverage for Genes.TSS1kb.ATAC.Spermatocytes.tagAlign.gz
Running piped cmds: ['bedtools intersect -u -a /home/jl9324/Sperm_3D_Genome_Project/multiome/processed/bigwig/Spermatocytes.tagAlign.gz -b /home/jl9324/Sperm_3D_Genome_Project/multiome/ABC_model/tmp/GRCh38_EBV.no_alt.chrom.sizes.tsv.bed', 'bedtools coverage -counts -sorted -g /home/jl9324/env/download/ABC-Enhancer-Gene-Prediction/reference/hg38/GRCh38_EBV.no_alt.chrom.sizes.tsv -b - -a /home/jl9324/Sperm_3D_Genome_Project/multiome/ABC_model/SPT/Neighborhoods/GeneList.TSS1kb.bed', 'awk \'{{print $1 "\\t" $2 "\\t" $3 "\\t" $NF}}\' > /home/jl9324/Sperm_3D_Genome_Project/multiome/ABC_model/SPT/Neighborhoods/Genes.TSS1kb.ATAC.Spermatocytes.tagAlign.gz.CountReads.bedgraph']
Running command: awk 'BEGIN {FS=OFS="\t"} (substr($1, length($1)) == "X" || substr($1, length($1)) == "Y") { $4 *= 2 } 1' /home/jl9324/Sperm_3D_Genome_Project/multiome/ABC_model/SPT/Neighborhoods/Genes.TSS1kb.ATAC.Spermatocytes.tagAlign.gz.CountReads.bedgraph > /home/jl9324/Sperm_3D_Genome_Project/multiome/ABC_model/SPT/Neighborhoods/Genes.TSS1kb.ATAC.Spermatocytes.tagAlign.gz.CountReads.bedgraph.tmp && mv /home/jl9324/Sperm_3D_Genome_Project/multiome/ABC_model/SPT/Neighborhoods/Genes.TSS1kb.ATAC.Spermatocytes.tagAlign.gz.CountReads.bedgraph.tmp /home/jl9324/Sperm_3D_Genome_Project/multiome/ABC_model/SPT/Neighborhoods/Genes.TSS1kb.ATAC.Spermatocytes.tagAlign.gz.CountReads.bedgraph
Feature ATAC completed in 178.59735417366028
Generating /home/jl9324/Sperm_3D_Genome_Project/multiome/ABC_model/SPT/Neighborhoods/Enhancers.ATAC.Spermatocytes.tagAlign.gz.CountReads.bedgraph
Counting coverage for Enhancers.ATAC.Spermatocytes.tagAlign.gz
Running piped cmds: ['bedtools intersect -u -a /home/jl9324/Sperm_3D_Genome_Project/multiome/processed/bigwig/Spermatocytes.tagAlign.gz -b /home/jl9324/Sperm_3D_Genome_Project/multiome/ABC_model/tmp/GRCh38_EBV.no_alt.chrom.sizes.tsv.bed', 'bedtools coverage -counts -sorted -g /home/jl9324/env/download/ABC-Enhancer-Gene-Prediction/reference/hg38/GRCh38_EBV.no_alt.chrom.sizes.tsv -b - -a /home/jl9324/Sperm_3D_Genome_Project/multiome/ABC_model/SPT/Peaks/macs2_peaks.narrowPeak.sorted.candidateRegions.bed', 'awk \'{{print $1 "\\t" $2 "\\t" $3 "\\t" $NF}}\' > /home/jl9324/Sperm_3D_Genome_Project/multiome/ABC_model/SPT/Neighborhoods/Enhancers.ATAC.Spermatocytes.tagAlign.gz.CountReads.bedgraph']
Running command: awk 'BEGIN {FS=OFS="\t"} (substr($1, length($1)) == "X" || substr($1, length($1)) == "Y") { $4 *= 2 } 1' /home/jl9324/Sperm_3D_Genome_Project/multiome/ABC_model/SPT/Neighborhoods/Enhancers.ATAC.Spermatocytes.tagAlign.gz.CountReads.bedgraph > /home/jl9324/Sperm_3D_Genome_Project/multiome/ABC_model/SPT/Neighborhoods/Enhancers.ATAC.Spermatocytes.tagAlign.gz.CountReads.bedgraph.tmp && mv /home/jl9324/Sperm_3D_Genome_Project/multiome/ABC_model/SPT/Neighborhoods/Enhancers.ATAC.Spermatocytes.tagAlign.gz.CountReads.bedgraph.tmp /home/jl9324/Sperm_3D_Genome_Project/multiome/ABC_model/SPT/Neighborhoods/Enhancers.ATAC.Spermatocytes.tagAlign.gz.CountReads.bedgraph
Feature ATAC completed in 182.45945739746094
Assigning classes to enhancers
Total enhancers: 156680
         Promoters: 21133
         Genic: 68452
         Intergenic: 67095
Neighborhoods Complete! 

[Tue Mar  4 15:31:57 2025]
Finished job 0.
1 of 1 steps (100%) done
